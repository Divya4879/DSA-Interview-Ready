{% extends "base.html" %}

{% block title %}Analytics - CodeInterview AI{% endblock %}

{% block content %}
<div class="section">
    <div class="container">
        <div class="section-title">Your Analytics Dashboard</div>
        
        <!-- Key Metrics -->
        <div class="grid grid-4 mb-8">
            <div class="card text-center">
                <div class="stat-number text-secondary-yellow">{{ stats.problems_solved or 0 }}</div>
                <div class="stat-label">Problems Solved</div>
            </div>
            <div class="card text-center">
                <div class="stat-number text-primary-red">{{ stats.average_score or 0 }}%</div>
                <div class="stat-label">Average Score</div>
            </div>
            <div class="card text-center">
                <div class="stat-number text-secondary-yellow">{{ stats.streak or 0 }}</div>
                <div class="stat-label">Current Streak</div>
            </div>
            <div class="card text-center">
                <div class="stat-number text-primary-red">#{{ stats.rank or 'N/A' }}</div>
                <div class="stat-label">Global Rank</div>
            </div>
        </div>

        <!-- Charts -->
        <div class="grid grid-2 mb-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Progress Over Time</h3>
                </div>
                <canvas id="progressChart" width="400" height="200"></canvas>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Topic Distribution</h3>
                </div>
                <canvas id="topicChart" width="400" height="200"></canvas>
            </div>
        </div>

        <!-- Detailed Stats -->
        <div class="grid grid-2">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Recent Submissions</h3>
                </div>
                <div id="recent-submissions">
                    <div class="text-center text-muted">Loading recent submissions...</div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Skill Breakdown</h3>
                </div>
                <div class="space-y-4">
                    <div class="skill-item">
                        <div class="flex justify-between mb-2">
                            <span>Code Quality</span>
                            <span>{{ stats.code_quality or 0 }}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ stats.code_quality or 0 }}%"></div>
                        </div>
                    </div>
                    <div class="skill-item">
                        <div class="flex justify-between mb-2">
                            <span>Algorithm Efficiency</span>
                            <span>{{ stats.algorithm_efficiency or 0 }}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ stats.algorithm_efficiency or 0 }}%"></div>
                        </div>
                    </div>
                    <div class="skill-item">
                        <div class="flex justify-between mb-2">
                            <span>Communication</span>
                            <span>{{ stats.communication or 0 }}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ stats.communication or 0 }}%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.progress-bar {
    width: 100%;
    height: 8px;
    background: var(--dark-elevated);
    border-radius: 4px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: var(--gradient-primary);
    transition: width 0.3s ease;
}

.skill-item {
    padding: 1rem;
    background: var(--dark-elevated);
    border-radius: var(--border-radius-md);
}
</style>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Progress Chart
    const progressCtx = document.getElementById('progressChart').getContext('2d');
    new Chart(progressCtx, {
        type: 'line',
        data: {
            labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
            datasets: [{
                label: 'Average Score',
                data: [65, 72, 78, 85],
                borderColor: '#f59e0b',
                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    labels: {
                        color: '#d1d5db'
                    }
                }
            },
            scales: {
                y: {
                    ticks: {
                        color: '#9ca3af'
                    },
                    grid: {
                        color: '#374151'
                    }
                },
                x: {
                    ticks: {
                        color: '#9ca3af'
                    },
                    grid: {
                        color: '#374151'
                    }
                }
            }
        }
    });

    // Topic Chart
    const topicCtx = document.getElementById('topicChart').getContext('2d');
    new Chart(topicCtx, {
        type: 'doughnut',
        data: {
            labels: ['Arrays', 'Strings', 'Trees', 'Graphs', 'DP'],
            datasets: [{
                data: [30, 25, 20, 15, 10],
                backgroundColor: [
                    '#dc2626',
                    '#f59e0b',
                    '#ea580c',
                    '#b91c1c',
                    '#d97706'
                ]
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    labels: {
                        color: '#d1d5db'
                    }
                }
            }
        }
    });
});
</script>
{% endblock %}
